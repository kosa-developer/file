<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="head">
        <script>
            function validate(evt) {
                var theEvent = evt || window.event;
                var key = theEvent.keyCode || theEvent.which;
                // Don't validate the input if below arrow, delete and backspace keys were pressed 
                if (key === 37 || key === 38 || key === 39 || key === 40
                        || key === 8 || key === 46) { // Left / Up / Right / Down Arrow, Backspace, Delete keys
                    return;
                }
                key = String.fromCharCode(key);
                var regex = /[0-9]|\.|\//;
//                var regex = /[0-9]/;
                if (!regex.test(key)) {
                    theEvent.returnValue = false;
                    if (theEvent.preventDefault)
                        theEvent.preventDefault();
                }
            }

        </script>
        <style type="text/css">
            button.ui-button {
                margin-right: .5rem;
            }
        </style>
    </ui:define>
    <ui:define name="content">
        <div class="card">
            <div class="p-col-12 p-md-12 p-sm-12">
                <h5>Patient information </h5>
            </div>
            <h:form id="receptionform">

                <h:panelGrid columns="3" cellpadding="5">
                    <p:photoCam widgetVar="pc" listener="#{reception.oncapture}" update="photo"/>
                    <p:commandButton type="button" value="Capture" onclick="PF('pc').capture()"/>
                    <p:outputPanel id="photo">
                        <p:graphicImage name="demo/images/photocam/#{reception.filename}.jpeg"
                                        rendered="#{not empty reception.filename}"/>
                    </p:outputPanel>
                </h:panelGrid>

                <div class="p-grid">

                    <div class="p-col-12 p-md-4 p-sm-12 card">
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:selectOneRadio id="console" value="#{reception.visittype}" requiredMessage="Visit must be filled" unselectable="true" required="true">
                                    <f:selectItem itemLabel="New patient" itemValue="New patient"/>
                                    <f:selectItem itemLabel="Revisit" itemValue="Revisit"/>
                                </p:selectOneRadio>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Patient Id"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.memberID}" requiredMessage="Patient Id must be filled"  required="true" readonly="true"/>
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Patient name"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText  required="true" requiredMessage="Patient must be entered"  value="#{reception.patientName}"/>
                                </div>
                            </div>
                        </div> 
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-12" value="Patient category"/>
                                <p:selectOneRadio  value="#{reception.patientCategory}"  unselectable="true">
                                    <f:selectItem itemLabel="Ugandan" itemValue="Ugandan"/>
                                    <f:selectItem itemLabel="Refugee" itemValue="Refugee"/>
                                    <f:selectItem itemLabel="Foreigner" itemValue="Foreigner"/>
                                </p:selectOneRadio>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="NIN/ID"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.nin}" />
                                </div>
                            </div>
                        </div>


                    </div>


                    <div class="p-col-12 p-md-4 p-sm-12 card">

                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-2" value="DOB"/>
                                <div class="p-col-12 p-md-4">
                                    <p:calendar id="dob" readonlyInput="true" mindate="#{reception.getMaxAge()}" maxdate="#{reception.getMinAge()}" value="#{reception.dob}" yearRange="c-120:c+120" required="true" navigator="true"  pattern="dd-MM-yyyy" requiredMessage="DOB  must be selected"  >
                                        <p:ajax event="dateSelect" update="weightforheight,weightforheightlabel,age" listener="#{reception.returnAge}"  />
                                    </p:calendar> 
                                </div>
                                <div class="p-field p-grid p-col-12 p-md-6">
                                    <div class="p-col-12 p-md-12">
                                        <p:inputText id="age" value="#{reception.convertedAge}"  >
                                            <p:ajax event="blur" update="dob,notification,weightforheight,weightforheightlabel,age" listener="#{reception.returndob()}"></p:ajax>
                                        </p:inputText>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <div class="p-field p-grid p-col-12 p-md-5">
                                    <p:outputLabel  styleClass="p-col-12 p-md-2" value="Gender"/>
                                    <p:selectOneRadio value="#{reception.gender}"  unselectable="true" requiredMessage="Gender must be selected"  required="true">
                                        <f:selectItem itemLabel="M" itemValue="Male"/>
                                        <f:selectItem itemLabel="F" itemValue="Female"/>
                                        <p:ajax event="change" listener="#{reception.calculate_bmi_or_zscore()}" update="weightforheight,weightforheightlabel"/>

                                    </p:selectOneRadio>
                                </div>

                                <div class="p-field p-grid p-col-12 p-md-7">
                                    <p:outputLabel  styleClass="p-col-12 p-md-12" value="Phone"/>
                                    <div class="p-col-12 p-md-12">
                                        <p:inputText value="#{reception.phone}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="District"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.district}" />
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Subcounty"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.subcounty}" />
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="p-col-12 p-md-4 p-sm-12 card">


                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Village"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.village}" />
                                </div>
                            </div>
                        </div>

                        <h6>Next of kin</h6>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Name"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.nxtname}" />
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Relationship"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.relationship}" />
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid">
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Phone"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.nxtphone}" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-col-12 p-md-12 p-sm-12 card p-grid">
                        <div class="p-col-12 p-md-12 p-sm-12">
                            <h5>Patient Vitals </h5>
                        </div>

                        <div class="ui-fluid p-col-12 p-md-4 p-sm-12">

                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Weight:"/>
                                <div class="p-col-12 p-md-8">
                                    <p:spinner id="weightSpinner" size="4" value="#{reception.weight}" stepFactor="0.1" requiredMessage="Weight must be filled"  required="required" onkeypress="validate(event);
                                            if (event.keyCode == 13) {
                                                calculateBMIorZscore()
                                            }
                                            ;"><f:convertNumber pattern="#.#"/>
                                        <p:ajax event="change" listener="#{reception.calculate_bmi_or_zscore()}" update="weightforheight,weightforheightlabel"/>
                                    </p:spinner>
                                </div>
                            </div>
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Height"/>
                                <div class="p-col-12 p-md-8">
                                    <p:spinner id="heightSpinner" size="4" required="true" requiredMessage="Height must be filled" value="#{reception.height}" stepFactor="0.1" onkeypress="validate(event);
                                            if (event.keyCode == 13) {
                                                calculateBMIorZscore()
                                            }
                                            ;"><f:convertNumber pattern="#.#"/>
                                        <p:ajax event="change" listener="#{reception.calculate_bmi_or_zscore()}" update="weightforheight,weightforheightlabel"/>
                                    </p:spinner>
                                </div>
                            </div>
                            <div class="p-field p-grid">
                                <p:outputLabel id="weightforheightlabel"  styleClass="p-col-12 p-md-4" value="#{reception.weight_for_height_label}"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText readonly="true" id="weightforheight" value="#{reception.weight_For_Height}" style="color: blue;"/>
                                </div>
                            </div>
                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Temperature" />
                                <div class="p-col">
                                    <p:spinner id="tempSpinner" size="4" required="true" requiredMessage="Temperature must be filled" value="#{reception.temperature}" stepFactor="0.01" onkeypress="validate(event);"/>

                                </div>
                            </div>
                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Oxgyen Saturation:"/>
                                <div class="p-col">
                                    <p:inputText value="#{reception.oxy_saturation}" onkeypress="validate(event);"/>
                                </div>
                            </div>
                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Pulse:"/>
                                <div class="p-col">
                                    <p:inputText value="#{reception.heart_pulse}" onkeypress="validate(event);"/>

                                </div>
                            </div>

                        </div>
                        <div class="ui-fluid p-col-12 p-md-4 p-sm-12">

                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Blood Pressure:"/>
                                <div class="p-col">
                                    <p:inputText value="#{reception.blood_pressure}" onkeypress="validate(event);"/>

                                </div>
                            </div>
                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Respiratory Rate:"/>
                                <div class="p-col">
                                    <p:inputText value="#{reception.respiratory_rate}" onkeypress="validate(event);"/>

                                </div>
                            </div>

                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="ITN In Use:"/>
                                <div class="p-col">
                                    <p:selectOneMenu value="#{reception.itn_in_use}" requiredMessage="ITN in use must be selected"  required="true"> 
                                        <f:selectItem itemLabel="select" itemValue="" />  
                                        <f:selectItem itemLabel="True" itemValue="True" />  
                                        <f:selectItem itemLabel="False" itemValue="False" />  
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="MUAC:"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.muac}" onkeypress="validate(event);" />
                                </div>
                            </div>
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Immunisation:"/>
                                <div class="p-col-12 p-md-8">
                                    <p:selectOneMenu value="#{reception.imm_status}" >
                                        <f:selectItem itemLabel="Select" itemValue="" />  
                                        <f:selectItem itemLabel="Incomplete" itemValue="Incomplete" />  
                                        <f:selectItem itemLabel="Not Up To Date" itemValue="Not Up To Date" />
                                        <f:selectItem itemLabel="Up To Date" itemValue="Up To Date" />
                                        <f:selectItem itemLabel="Complete" itemValue="Complete" />  
                                        <f:selectItem itemLabel="Not Known" itemValue="Not Known" />  
                                    </p:selectOneMenu>
                                </div>
                            </div>

                        </div>

                        <div class="ui-fluid p-col-12 p-md-4 p-sm-12">

                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Tobacco Exposure:"/>
                                <div class="p-col-12 p-md-8">
                                    <p:selectOneMenu value="#{reception.smoker}">
                                        <f:selectItem itemLabel="Select" itemValue="" />  
                                        <f:selectItem itemLabel="Current Smoker" itemValue="Current" />  
                                        <f:selectItem itemLabel="Previous Smoker" itemValue="Previous" />
                                        <f:selectItem itemLabel="Currently exposed" itemValue="Exposed" />
                                        <f:selectItem itemLabel="None of these" itemValue="None" />
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Ever Drinks Alcohol:"/>
                                <div class="p-col-12 p-md-8">
                                    <p:selectOneMenu value="#{reception.alcohol}" >
                                        <f:selectItem itemLabel="Select" itemValue="" />  
                                        <f:selectItem itemLabel="No" itemValue="No" />  
                                        <f:selectItem itemLabel="Yes" itemValue="Yes" />
                                    </p:selectOneMenu>
                                </div>
                            </div>

                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Reffered in"/>
                                <div class="p-col">
                                    <p:selectOneMenu required="true" requiredMessage="Referral decision  must be selected"  value="#{reception.referral_status}" >
                                        <f:selectItem itemLabel="Select" itemValue="" />
                                        <f:selectItem itemLabel="No" itemValue="No"/>
                                        <f:selectItem itemLabel="Yes with form" itemValue="Yes-with form"/>
                                        <f:selectItem itemLabel="Yes without form" itemValue="Yes-without form"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>

                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Reffered from"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.referred_from}" />
                                </div>
                            </div>
                            <div class="p-field p-grid">
                                <p:outputLabel  styleClass="p-col-12 p-md-4" value="Refferal Number"/>
                                <div class="p-col-12 p-md-8">
                                    <p:inputText value="#{reception.referral_num}" />
                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid p-col-12 p-md-8 p-sm-12">
                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Problem and Reason for Visit:"/>
                                <div class="p-col">
                                    <p:inputTextarea  autoResize="false" value="#{reception.problem}"/>

                                </div>
                            </div>
                        </div>
                        <div class="ui-fluid p-col-12 p-md-4 p-sm-12">
                            <div class="p-field p-grid ">
                                <p:outputLabel   styleClass="p-col-12 p-md-4" value="Triage Category:"/>
                                <div class="p-col">
                                    <p:selectOneMenu value="#{reception.triage_category}" requiredMessage="Triage Category must be selected"  required="true">  
                                        <f:selectItem itemLabel="select" itemValue="" /> 
                                        <f:selectItem itemLabel="Green (Normal)" itemValue="Green" />  
                                        <f:selectItem itemLabel="Yellow (Priority)" itemValue="Yellow" />  
                                        <f:selectItem itemLabel="Red (Emergency)" itemValue="Red" />

                                    </p:selectOneMenu>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <p:commandButton value="Save Data" action="#{reception.savedata()}" update="receptionform" styleClass="ui-button-primary" icon="pi pi-check"  iconPos="right"  />

                <p:messages id="notification"/>
            </h:form>

            <div class="card">
                <h5>Test Request</h5>
              
                <h:form id="pannels">
                  

                        <div class="ui-fluid p-formgrid p-grid p-col-12 p-md-12">
                            <div class="p-field p-col-12 p-md-4">
                                <p:outputLabel for="testcat" value="Test Category"/>
                                <p:selectOneMenu id="testcat" value="#{reception.test_category_id}">  
                                    <f:selectItem itemLabel="Select Category" itemValue="0" />  
                                    <f:selectItems value="#{reception.reception_get_test_categoryz()}" var="category" itemLabel="#{category.category_desc}" itemValue="#{category.category_id}" />  
                                    <p:ajax update="testname"/>
                                </p:selectOneMenu>
                            </div>
                            <div class="p-field p-col-12 p-md-4">
                                <p:outputLabel for="testname" value="Test Name"/>
                                <p:selectOneMenu id="testname" value="#{reception.test_name_id}">  
                                    <f:selectItem itemLabel="Select Test Name" itemValue="" />  
                                    <f:selectItems value="#{dynamicFunctionsBean.ReturnSpecialdropdownList('test_names', 'test_id', 'test_name','category_id', reception.test_category_id)}" var="test" itemLabel="#{test.dropdownValue}" itemValue="#{test.dropdownId}" />  
                                    <p:ajax  event="change" update="price" listener="#{reception.priceReturn()}"/>
                                </p:selectOneMenu>
                            </div>
                            <div class="p-field p-col-12 p-md-2">
                                <p:outputLabel for="price" value="Price"/>
                                <p:inputText id="price" value="#{reception.price}"/>
                            </div>
                            <div class="p-field p-col-12 p-md-2">
                                <p:outputLabel for="urgency" value="Priolity"/>
                                <p:selectOneMenu id="urgency" value="#{reception.lab_urgency}"> 
                                    <f:selectItem itemLabel="Normal" itemValue="Normal" />  
                                    <f:selectItem itemLabel="High" itemValue="High" />
                                </p:selectOneMenu>
                            </div>

                        </div>

                        <p:commandButton update="testmsss,selectedTests" action="#{reception.reception_add_test_request()}"  value="add test" styleClass="ui-button-secondary" icon="pi pi-check"  iconPos="right" />
                        <p:messages id="testmsss"/>
                        <div class="card ui-fluid p-formgrid p-grid p-col-12 p-md-12">
                            <p:dataTable id="selectedTests" value="#{reception.tests_requested}" 
                                         paginator="true" rows="4" paginatorPosition="bottom" var="testrequest" style="width: 100%;">

                                <p:column headerText="Test Category" styleClass="tblcol4">  
                                    #{testrequest.category_desc}
                                </p:column>  

                                <p:column headerText="Test Name" styleClass="tblcol10">  
                                    #{testrequest.test_name}
                                </p:column>  
                                <p:column headerText="Price" styleClass="tblcol10">  
                                    #{testrequest.price}
                                </p:column> 
                                <p:column styleClass="tblcol2">  
                                    <p:commandLink value="Delete" update=":pannels:selectedTests,:pannels:testmsss" style="color: black;width: 10%;" action="#{reception.reception_laboratory_delete_pending(testrequest.request_id)}" />
                                </p:column> 

                            </p:dataTable>

                        </div>

                   

                </h:form>
                <div>
                    <h:form id="forwardform">
                        <p:messages id="finalmess"/>
                        <p:selectBooleanCheckbox id="skipacc" value="#{reception.skip_accounts}" itemLabel="Skip Accounts"/>  
                        <p:commandButton value="Confirm request" action="#{reception.confirmrequest()}" update="forwardform,receptionform,pannels" styleClass="ui-button-primary" icon="pi pi-check"  iconPos="right"  />

                    </h:form>
                </div>


            </div>


        </div>

    </ui:define>

</ui:composition>

